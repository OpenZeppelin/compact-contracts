:github-icon: pass:[<svg class="icon"><use href="#github-icon"/></svg>]
:accessControl-guide: xref:accessControl.adoc[AccessControl guide]

= AccessControl

This page provides the full AccessControl module API.

TIP: For an overview of the module, read the {accessControl-guide}.

== Core

[.hljs-theme-dark]
```ts
import "./node_modules/@openzeppelin-compact/access-control" prefix AccessControl_;
```

[.contract]
[[AccessControl]]
=== `++AccessControl++` link:https://github.com/OpenZeppelin/compact-contracts/tree/main/contracts/accessControl/src/AccessControl.compact[{github-icon},role=heading-link]

[.contract-index]
.Circuits
--

[.sub-index#AccessControlModule]
* xref:#AccessControl-hasRole[`++hasRole(roleId, account)++`]
* xref:#AccessControl-assertOnlyRole[`++assertOnlyRole(roleId)++`]
* xref:#AccessControl-_checkRole[`++_checkRole(roleId, account)++`]
* xref:#AccessControl-getRoleAdmin[`++getRoleAdmin(roleId)++`]
* xref:#AccessControl-grantRole[`++grantRole(roleId, account)++`]
* xref:#AccessControl-revokeRole[`++revokeRole(roleId, account)++`]
* xref:#AccessControl-renounceRole[`++renounceRole(roleId, callerConfirmation)++`]
* xref:#AccessControl-_setRoleAdmin[`++_setRoleAdmin(roleId, adminRole)++`]
* xref:#AccessControl-_grantRole[`++_grantRole(roleId, account)++`]
* xref:#AccessControl-_unsafeGrantRole[`++_unsafeGrantRole(roleId, account)++`]
* xref:#AccessControl-_revokeRole[`++_revokeRole(roleId, account)++`]
--

[.contract-item]
[[AccessControl-hasRole]]
==== `[.contract-item-name]#++hasRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → Boolean++` [.item-kind]#circuit#

Returns `true` if `account` has been granted `roleId`.

[.contract-item]
[[AccessControl-assertOnlyRole]]
==== `[.contract-item-name]#++assertOnlyRole++#++(roleId: Bytes<32>) → []++` [.item-kind]#circuit#

Reverts if `own_public_key()` is missing `roleId`.

Requirements:

- The caller must have `roleId`.

[.contract-item]
[[AccessControl-_checkRole]]
==== `[.contract-item-name]#++_checkRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → []++` [.item-kind]#circuit#

Reverts if `account` is missing `roleId`.

Requirements:

- `account` must have `roleId`.

[.contract-item]
[[AccessControl-getRoleAdmin]]
==== `[.contract-item-name]#++getRoleAdmin++#++(roleId: Bytes<32>) → Bytes<32>++` [.item-kind]#circuit#

Returns the admin role that controls `roleId` or a byte array with all zero bytes if `roleId` doesn't exist. See xref:#AccessControl-grantRole[grantRole] and xref:#AccessControl-revokeRole[revokeRole].

To change a role's admin use xref:#AccessControl-_setRoleAdmin[_setRoleAdmin].

[.contract-item]
[[AccessControl-grantRole]]
==== `[.contract-item-name]#++grantRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → []++` [.item-kind]#circuit#

Grants `roleId` to `account`.

NOTE: Granting roles to contract addresses is currently disallowed until contract-to-contract interactions are supported in Compact.
This restriction prevents permanently disabling access to a circuit.

Requirements:

- `account` must not be a ContractAddress.
- The caller must have ``roleId``'s admin role.

[.contract-item]
[[AccessControl-revokeRole]]
==== `[.contract-item-name]#++revokeRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → []++` [.item-kind]#circuit#

Revokes `roleId` from `account`.

Requirements:

- The caller must have ``roleId``'s admin role.

[.contract-item]
[[AccessControl-renounceRole]]
==== `[.contract-item-name]#++renounceRole++#++(roleId: Bytes<32>, callerConfirmation: Either<ZswapCoinPublicKey, ContractAddress>) → []++` [.item-kind]#circuit#

Revokes `roleId` from the calling account.

Roles are often managed via xref:#AccessControl-grantRole[grantRole] and xref:#AccessControl-revokeRole[revokeRole]: this circuit's
purpose is to provide a mechanism for accounts to lose their privileges
if they are compromised (such as when a trusted device is misplaced).

NOTE: We do not provide functionality for smart contracts to renounce roles because self-executing transactions are not supported on Midnight at this time. We may revisit this in future if this feature is made available in Compact.

Requirements:

- The caller must be `callerConfirmation`.
- The caller must not be a `ContractAddress`.

[.contract-item]
[[AccessControl-_setRoleAdmin]]
==== `[.contract-item-name]#++_setRoleAdmin++#++(roleId: Bytes<32>, adminRole: Bytes<32>) → []++` [.item-kind]#circuit#

Sets `adminRole` as ``roleId``'s admin role.

[.contract-item]
[[AccessControl-_grantRole]]
==== `[.contract-item-name]#++_grantRole++#++(roleId: Bytes<32>, adminRole: Bytes<32>) → Boolean++` [.item-kind]#circuit#

Attempts to grant `roleId` to `account` and returns a boolean indicating if `roleId` was granted.

Internal circuit without access restriction.

NOTE: Granting roles to contract addresses is currently disallowed until contract-to-contract interactions are supported in Compact.
This restriction prevents permanently disabling access to a circuit.

Requirements:

- `account` must not be a ContractAddress.

[.contract-item]
[[AccessControl-_unsafeGrantRole]]
==== `[.contract-item-name]#++_unsafeGrantRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → Boolean++` [.item-kind]#circuit#

Unsafe variant of <<AccessControl-_grantRole,_grantRole>>.

WARNING: Granting roles to contract addresses is considered unsafe because contract-to-contract calls are not currently supported.
Granting a role to a smart contract may render a circuit permanently inaccessible.
Once contract-to-contract calls are supported, this circuit may be deprecated.

[.contract-item]
[[AccessControl-_revokeRole]]
==== `[.contract-item-name]#++_revokeRole++#++(roleId: Bytes<32>, account: Either<ZswapCoinPublicKey, ContractAddress>) → Boolean++` [.item-kind]#circuit#

Attempts to revoke `roleId` from `account` and returns a boolean indicating if `roleId` was revoked.

Internal circuit without access restriction.